---
// Componente de formulario de entrada para el cotizador
---

<div class="formulario-entrada">
  <h2 class="form-title">
    <i class="fas fa-clipboard-list"></i>
    Datos del Cliente y Proyecto
  </h2>

  <!-- Datos del Cliente -->
  <section class="form-section">
    <h3 class="section-title">Datos del Cliente</h3>
    <div class="form-grid">
      <div class="form-group">
        <label for="clienteNombre">Nombre *</label>
        <input 
          type="text" 
          id="clienteNombre" 
          class="form-input" 
          required
          placeholder="Ej: Juan"
        >
      </div>
      <div class="form-group">
        <label for="clienteApellidos">Apellidos</label>
        <input 
          type="text" 
          id="clienteApellidos" 
          class="form-input"
          placeholder="Ej: Pérez"
        >
      </div>
      <div class="form-group">
        <label for="clienteNit">NIT / Cédula</label>
        <input 
          type="text" 
          id="clienteNit" 
          class="form-input"
          placeholder="Ej: 1234567890"
        >
      </div>
      <div class="form-group">
        <label for="nombreProyecto">Nombre del Proyecto</label>
        <input 
          type="text" 
          id="nombreProyecto" 
          class="form-input"
          placeholder="Ej: Sistema Solar Residencial"
        >
      </div>
      <div class="form-group">
        <label for="clienteEmail">Email *</label>
        <input 
          type="email" 
          id="clienteEmail" 
          class="form-input" 
          required
          placeholder="ejemplo@email.com"
        >
      </div>
      <div class="form-group">
        <label for="clienteTelefono">Teléfono *</label>
        <input 
          type="tel" 
          id="clienteTelefono" 
          class="form-input" 
          required
          placeholder="Ej: 3001234567"
        >
      </div>
      <div class="form-group">
        <label for="clienteDireccion">Dirección</label>
        <input 
          type="text" 
          id="clienteDireccion" 
          class="form-input"
          placeholder="Ej: Calle 123 #45-67"
        >
      </div>
      <div class="form-group">
        <label for="clienteDepartamento">Departamento *</label>
        <select 
          id="clienteDepartamento" 
          class="form-input" 
          required
        >
          <option value="">Seleccione un departamento...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="clienteCiudad">Ciudad *</label>
        <select 
          id="clienteCiudad" 
          class="form-input" 
          required
          disabled
        >
          <option value="">Primero seleccione un departamento</option>
        </select>
      </div>
      <div class="form-group">
        <label for="tipoCliente">Tipo de Cliente *</label>
        <select id="tipoCliente" class="form-input" required>
          <option value="">Seleccione...</option>
          <option value="residencial">Residencial</option>
          <option value="comercial">Comercial</option>
          <option value="industrial">Industrial</option>
          <option value="oficial">Oficial</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Modelo de Negocio -->
  <section class="form-section">
    <h3 class="section-title">Modelo de Negocio</h3>
    <div class="radio-group">
      <label class="radio-option">
        <input type="radio" name="modeloNegocio" value="epc" checked>
        <span class="radio-label">
          <i class="fas fa-hand-holding-usd"></i>
          <strong>EPC</strong>
          <small>Inversión total - Eres propietario</small>
        </span>
      </label>
      <label class="radio-option">
        <input type="radio" name="modeloNegocio" value="ppa">
        <span class="radio-label">
          <i class="fas fa-file-contract"></i>
          <strong>PPA</strong>
          <small>Sin inversión inicial - Compra de energía</small>
        </span>
      </label>
    </div>
    <div id="infoModelo" class="modelo-info">
      <p id="infoEPC" style="display: block;">
        <i class="fas fa-info-circle"></i>
        <strong>EPC (Engineering, Procurement, Construction):</strong> Realizas la inversión total del sistema y eres propietario. 
        Recibes todos los ahorros y beneficios económicos. Incluye análisis financiero completo (TIR, VAN, ROI).
      </p>
      <p id="infoPPA" style="display: none;">
        <i class="fas fa-info-circle"></i>
        <strong>PPA (Power Purchase Agreement):</strong> Sin inversión inicial. Un tercero financia el sistema y tú compras la energía 
        generada a un precio fijo, generalmente menor que la tarifa de red. Contrato a largo plazo (10-15 años).
      </p>
    </div>
  </section>

  <!-- Tipo de Sistema -->
  <section class="form-section">
    <h3 class="section-title">Tipo de Sistema</h3>
    <div class="radio-group">
      <label class="radio-option">
        <input type="radio" name="tipoSistema" value="on-grid" checked>
        <span class="radio-label">
          <i class="fas fa-plug"></i>
          <strong>On-Grid</strong>
          <small>Conectado a la red eléctrica</small>
        </span>
      </label>
      <label class="radio-option">
        <input type="radio" name="tipoSistema" value="off-grid">
        <span class="radio-label">
          <i class="fas fa-battery-full"></i>
          <strong>Off-Grid</strong>
          <small>Sistema aislado con baterías</small>
        </span>
      </label>
      <label class="radio-option">
        <input type="radio" name="tipoSistema" value="hibrido">
        <span class="radio-label">
          <i class="fas fa-exchange-alt"></i>
          <strong>Híbrido</strong>
          <small>Conectado a red + baterías</small>
        </span>
      </label>
    </div>
  </section>

  <!-- Datos On-Grid -->
  <section id="datosOnGrid" class="form-section datos-sistema">
    <h3 class="section-title">Datos del Sistema On-Grid</h3>
    
    <!-- Campos específicos PPA (solo para On-Grid con PPA) -->
    <div id="datosPPA" class="ppa-params" style="display: none;">
      <h4 class="subsection-title">Parámetros PPA</h4>
      <div class="form-grid">
        <div class="form-group">
          <label for="duracionContratoPPA">Duración del Contrato (años) *</label>
          <select id="duracionContratoPPA" class="form-input">
            <option value="10">10 años</option>
            <option value="12" selected>12 años</option>
            <option value="15">15 años</option>
          </select>
          <small class="form-help">Duración del contrato PPA</small>
        </div>
      </div>
    </div>
    
    <div class="form-grid">
      <div class="form-group full-width">
        <label for="consumoPromedio">Consumo Mensual Promedio (kWh/mes) *</label>
        <input 
          type="number" 
          id="consumoPromedio" 
          class="form-input" 
          min="0" 
          step="0.1"
          placeholder="Ej: 850"
        >
        <small class="form-help">
          Se generarán automáticamente 12 valores mensuales con variación del 2% (julio y diciembre +10%)
        </small>
      </div>
      <div class="form-group full-width">
        <label>Consumos Mensuales (kWh) - Opcional</label>
        <div class="consumos-mensuales">
          <div class="mes-input">
            <label>Ene</label>
            <input type="number" class="consumo-mes" data-mes="0" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Feb</label>
            <input type="number" class="consumo-mes" data-mes="1" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Mar</label>
            <input type="number" class="consumo-mes" data-mes="2" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Abr</label>
            <input type="number" class="consumo-mes" data-mes="3" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>May</label>
            <input type="number" class="consumo-mes" data-mes="4" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Jun</label>
            <input type="number" class="consumo-mes" data-mes="5" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Jul</label>
            <input type="number" class="consumo-mes" data-mes="6" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Ago</label>
            <input type="number" class="consumo-mes" data-mes="7" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Sep</label>
            <input type="number" class="consumo-mes" data-mes="8" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Oct</label>
            <input type="number" class="consumo-mes" data-mes="9" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Nov</label>
            <input type="number" class="consumo-mes" data-mes="10" min="0" step="0.1">
          </div>
          <div class="mes-input">
            <label>Dic</label>
            <input type="number" class="consumo-mes" data-mes="11" min="0" step="0.1">
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="tarifaElectrica">Tarifa Eléctrica ($/kWh) *</label>
        <input 
          type="number" 
          id="tarifaElectrica" 
          class="form-input" 
          min="0" 
          step="0.01"
          placeholder="Ej: 1132.48"
        >
      </div>
      <div class="form-group">
        <label for="porcentajeAutoconsumo">% Autoconsumo Deseado *</label>
        <input 
          type="number" 
          id="porcentajeAutoconsumo" 
          class="form-input" 
          min="0" 
          max="100" 
          value="60"
          step="1"
        >
        <small class="form-help">Porcentaje de energía generada que se consume directamente</small>
      </div>
      <div class="form-group">
        <label for="tarifaVentaExcedentes">Tarifa Venta Excedentes ($/kWh)</label>
        <input 
          type="number" 
          id="tarifaVentaExcedentes" 
          class="form-input" 
          min="0" 
          step="0.01"
          placeholder="Auto (90% de tarifa)"
        >
      </div>
      <div class="form-group">
        <label for="estacionMeteorologica">Estación Meteorológica</label>
        <input 
          type="text" 
          id="estacionMeteorologica" 
          class="form-input"
          placeholder="Ciudad de referencia para datos de radiación"
        >
        <small class="form-help">Ciudad de referencia para datos de radiación solar (se usa la ciudad seleccionada si está vacío)</small>
      </div>
      <div class="form-group">
        <label for="tipoCubierta">Tipo de Cubierta/Montaje *</label>
        <select id="tipoCubierta" class="form-input" required>
          <option value="">Seleccione el tipo de cubierta...</option>
          <option value="teja-barro">Teja de Barro</option>
          <option value="teja-ondulada">Teja Ondulada o Fibrocemento</option>
          <option value="teja-zinc">Teja de Zinc</option>
          <option value="teja-trapezoidal">Teja Trapezoidal</option>
          <option value="loza">Loza</option>
          <option value="alurack-l">Alurack con "L"</option>
          <option value="estructura-elevada">Estructura Elevada (Columnetas)</option>
          <option value="terreno">Terreno</option>
        </select>
        <small class="form-help">El tipo de cubierta afecta el precio de la estructura</small>
      </div>
      <div class="form-group">
        <label for="tipoAcometida">Tipo de Acometida</label>
        <select id="tipoAcometida" class="form-input">
          <option value="">Seleccione...</option>
          <option value="imc-exterior">IMC (Exterior)</option>
          <option value="subterranea">Subterránea</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ventaExcedentes">¿Venta de Excedentes?</label>
        <select id="ventaExcedentes" class="form-input">
          <option value="si">Sí</option>
          <option value="no">No</option>
        </select>
      </div>
      <div class="form-group">
        <label for="beneficiosLey1715">Beneficios de la Ley 1715</label>
        <select id="beneficiosLey1715" class="form-input">
          <option value="si">Sí</option>
          <option value="no">No</option>
        </select>
        <small class="form-help">Deducción del 50% de la inversión en impuestos</small>
      </div>
      <div class="form-group">
        <label for="estudioConexion">Estudio de Conexión</label>
        <select id="estudioConexion" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group">
        <label for="contadorBidireccional">¿Requiere Contador Bidireccional?</label>
        <select id="contadorBidireccional" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group">
        <label for="costoKwhBase">Costo kWh Base ($/kWh)</label>
        <input 
          type="number" 
          id="costoKwhBase" 
          class="form-input" 
          min="0" 
          step="0.01"
          placeholder="Ej: 943.74"
        >
        <small class="form-help">Tarifa base antes de contribución</small>
      </div>
      <div class="form-group">
        <label for="tieneContribucion">¿Tiene Contribución?</label>
        <select id="tieneContribucion" class="form-input">
          <option value="si">Sí</option>
          <option value="no">No</option>
        </select>
        <small class="form-help">Si tiene contribución, se suma el 20% al costo base</small>
      </div>
      <div class="form-group">
        <label for="porcentajeAhorro">% del Consumo que Desea Ahorrar</label>
        <input 
          type="number" 
          id="porcentajeAhorro" 
          class="form-input" 
          min="0" 
          max="100" 
          value="100"
          step="1"
        >
        <small class="form-help">Porcentaje del consumo que se desea cubrir (default: 100%)</small>
      </div>
      <div class="form-group">
        <label for="trmDolar">TRM Dólar (COP/USD)</label>
        <input 
          type="number" 
          id="trmDolar" 
          class="form-input" 
          min="0" 
          step="1"
          value="4000"
          placeholder="Ej: 4000"
        >
        <small class="form-help">Tasa Representativa del Mercado</small>
      </div>
      <div class="form-group">
        <label for="descuento">Descuento (%)</label>
        <input 
          type="number" 
          id="descuento" 
          class="form-input" 
          min="0" 
          max="100" 
          value="0"
          step="0.01"
          placeholder="Ej: 5"
        >
        <small class="form-help">Descuento general aplicable</small>
      </div>
      <div class="form-group">
        <label for="comisionAdicional">Comisión Adicional (%)</label>
        <input 
          type="number" 
          id="comisionAdicional" 
          class="form-input" 
          min="0" 
          max="100"
          step="0.1"
          value="0"
          placeholder="Ej: 5"
        >
        <small class="form-help">Porcentaje sobre el valor del proyecto (se calculará automáticamente)</small>
      </div>
      <div class="form-group">
        <label for="kmsMedellin">Kms del Proyecto a Medellín</label>
        <input 
          type="number" 
          id="kmsMedellin" 
          class="form-input" 
          min="0" 
          step="1"
          placeholder="Ej: 45"
        >
        <small class="form-help">Para calcular sobrecargo por lejanía</small>
      </div>
      <div class="form-group">
        <label for="sobrecargoLejania">Sobrecargo por Lejanía</label>
        <select id="sobrecargoLejania" class="form-input">
          <option value="no">No</option>
          <option value="ida-regreso">Ida y Regreso</option>
          <option value="solo-ida">Solo Ida</option>
        </select>
      </div>
      <div class="form-group">
        <label for="financiacion">Financiación</label>
        <select id="financiacion" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group" id="entidadFinancieraGroup" style="display: none;">
        <label for="entidadFinanciera">Entidad Financiera</label>
        <input 
          type="text" 
          id="entidadFinanciera" 
          class="form-input"
          placeholder="Ej: Somos EPM"
        >
      </div>
      <div class="form-group">
        <label for="requiereAndamios">¿Requiere ANDAMIOS?</label>
        <select id="requiereAndamios" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group" id="metrajeAndamioGroup" style="display: none;">
        <label for="metrajeAndamio">Metraje de Andamio [m]</label>
        <input 
          type="number" 
          id="metrajeAndamio" 
          class="form-input" 
          min="0" 
          step="0.1"
          value="0"
          placeholder="Ej: 0"
        >
      </div>
      <div class="form-group">
        <label for="eficienciaOptimo">Eficiencia Con Respecto al Óptimo</label>
        <input 
          type="number" 
          id="eficienciaOptimo" 
          class="form-input" 
          min="0" 
          max="1" 
          value="0.97"
          step="0.01"
          placeholder="0.97"
        >
        <small class="form-help">Factor de eficiencia del sistema (default: 0.97)</small>
      </div>
      <div class="form-group">
        <label for="cableadoDC">Cableado Distancia DC [m]</label>
        <input 
          type="number" 
          id="cableadoDC" 
          class="form-input" 
          min="0" 
          step="1"
          value="10"
          placeholder="Ej: 10"
        >
      </div>
      <div class="form-group">
        <label for="cableadoAC">Cableado Distancia AC [m]</label>
        <input 
          type="number" 
          id="cableadoAC" 
          class="form-input" 
          min="0" 
          step="1"
          value="10"
          placeholder="Ej: 10"
        >
      </div>
      <div class="form-group">
        <label for="polizas">Pólizas</label>
        <select id="polizas" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group">
        <label for="sst">SST (Seguridad y Salud en el Trabajo)</label>
        <select id="sst" class="form-input">
          <option value="no">No</option>
          <option value="si">Sí</option>
        </select>
      </div>
      <div class="form-group">
        <label for="obrasAdicionales">Valor u Obras Adicionales (COP)</label>
        <input 
          type="number" 
          id="obrasAdicionales" 
          class="form-input" 
          min="0" 
          step="1"
          value="0"
          placeholder="Ej: 0"
        >
      </div>
      <div class="form-group">
        <label for="porcentajeAutonomia">Porcentaje de Autonomía</label>
        <input 
          type="number" 
          id="porcentajeAutonomia" 
          class="form-input" 
          min="0" 
          max="100" 
          value="10"
          step="1"
        >
        <small class="form-help">Para sistemas híbridos (default: 10%)</small>
      </div>
    </div>
  </section>

  <!-- Datos Off-Grid -->
  <section id="datosOffGrid" class="form-section datos-sistema" style="display: none;">
    <h3 class="section-title">Datos del Sistema Off-Grid</h3>
    
    <!-- Lista de Equipos -->
    <div class="equipos-container">
      <div class="equipos-header">
        <h4 class="subsection-title">Equipos a Alimentar</h4>
        <button type="button" id="btnAgregarEquipo" class="btn-add-equipo">
          <i class="fas fa-plus"></i>
          Agregar Equipo
        </button>
      </div>
      
      <div id="listaEquipos" class="lista-equipos">
        <!-- Los equipos se agregarán dinámicamente aquí -->
      </div>
      
      <div class="consumo-total-container">
        <div class="consumo-total">
          <label>Consumo Diario Total Calculado:</label>
          <span id="consumoDiarioCalculado" class="consumo-total-value">0.00 kWh/día</span>
        </div>
      </div>
    </div>
    
    <div class="form-grid" style="margin-top: 2rem;">
      <div class="form-group">
        <label for="diasAutonomia">Días de Autonomía *</label>
        <input 
          type="number" 
          id="diasAutonomia" 
          class="form-input" 
          min="1" 
          value="3"
          step="1"
        >
        <small class="form-help">Días que debe durar la batería sin sol</small>
      </div>
      <div class="form-group">
        <label for="voltajeSistema">Voltaje del Sistema *</label>
        <select id="voltajeSistema" class="form-input">
          <option value="12">12V</option>
          <option value="24">24V</option>
          <option value="48" selected>48V</option>
        </select>
      </div>
      <div class="form-group">
        <label for="tipoConsumo">Tipo de Consumo</label>
        <select id="tipoConsumo" class="form-input">
          <option value="solo-dia">Solo durante el día</option>
          <option value="dia-noche">Día y noche</option>
          <option value="24h" selected>24 horas</option>
        </select>
      </div>
      <div class="form-group">
        <label for="profundidadDescarga">Profundidad de Descarga (%)</label>
        <input 
          type="number" 
          id="profundidadDescarga" 
          class="form-input" 
          min="20" 
          max="90" 
          value="50"
          step="1"
        >
        <small class="form-help">% máximo de descarga de la batería</small>
      </div>
    </div>
  </section>

  <!-- Botón Calcular -->
  <div class="form-actions">
    <button id="btnCalcular" class="btn-calculate">
      <i class="fas fa-calculator"></i>
      Calcular Sistema
    </button>
  </div>
</div>

<style>
  .formulario-entrada {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .form-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  .form-title i {
    color: #6b2181;
  }

  .form-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .form-section:last-of-type {
    border-bottom: none;
  }

  .section-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 1.5rem;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    font-size: 0.9rem;
    font-weight: 500;
    color: #6b7280;
    margin-bottom: 0.5rem;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  .form-input {
    padding: 0.75rem 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    transition: border-color 0.2s ease;
  }

  .form-input:focus {
    outline: none;
    border-color: #6b2181;
  }

  .form-help {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-top: 0.25rem;
    display: block;
  }

  /* Estilos para equipos Off-Grid */
  .equipos-container {
    margin-bottom: 2rem;
  }

  .equipos-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .subsection-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
  }

  .btn-add-equipo {
    background: #6b2181;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background 0.3s;
  }

  .btn-add-equipo:hover {
    background: #5a1a6f;
  }

  .btn-add-equipo i {
    font-size: 0.85rem;
  }

  .lista-equipos {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .equipo-item {
    background: #f9fafb;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 1.5rem;
    position: relative;
  }

  .equipo-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .equipo-header h5 {
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
  }

  .btn-remove-equipo {
    background: #ef4444;
    color: white;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s;
  }

  .btn-remove-equipo:hover {
    background: #dc2626;
  }

  .form-grid-equipo {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .equipo-consumo {
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
    font-size: 0.9rem;
    color: #6b7280;
  }

  .consumo-equipo-value {
    color: #6b2181;
    font-weight: 600;
    font-size: 1rem;
  }

  .consumo-total-container {
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: #f0f9ff;
    border: 2px solid #0ea5e9;
    border-radius: 12px;
  }

  .consumo-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .consumo-total label {
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
  }

  .consumo-total-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #0ea5e9;
  }

  .modelo-info {
    margin-top: 1rem;
    padding: 1rem;
    background: #f0f9ff;
    border-left: 4px solid #0ea5e9;
    border-radius: 6px;
  }

  .modelo-info p {
    margin: 0;
    font-size: 0.9rem;
    color: #1e40af;
    line-height: 1.6;
  }

  .modelo-info i {
    margin-right: 0.5rem;
    color: #0ea5e9;
  }

  .ppa-params {
    margin-bottom: 1.5rem;
    padding: 1.5rem;
    background: #fef3c7;
    border: 2px solid #f59e0b;
    border-radius: 8px;
  }

  .ppa-params .subsection-title {
    font-size: 1rem;
    font-weight: 600;
    color: #92400e;
    margin-bottom: 1rem;
  }

  .radio-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .radio-option {
    display: block;
    cursor: pointer;
  }

  .radio-option input[type="radio"] {
    display: none;
  }

  .radio-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    transition: all 0.2s ease;
    text-align: center;
  }

  .radio-label i {
    font-size: 2rem;
    color: #6b2181;
    margin-bottom: 0.5rem;
  }

  .radio-label strong {
    font-size: 1rem;
    color: #1f2937;
    margin-bottom: 0.25rem;
  }

  .radio-label small {
    font-size: 0.85rem;
    color: #6b7280;
  }

  .radio-option input[type="radio"]:checked + .radio-label {
    border-color: #6b2181;
    background: #f3e8ff;
  }

  .datos-sistema {
    background: #f9fafb;
    padding: 1.5rem;
    border-radius: 12px;
  }

  .consumos-mensuales {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.75rem;
  }

  .mes-input {
    display: flex;
    flex-direction: column;
  }

  .mes-input label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #6b7280;
    margin-bottom: 0.25rem;
    text-align: center;
  }

  .consumo-mes {
    padding: 0.5rem;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    font-size: 0.9rem;
    text-align: center;
  }

  .consumo-mes:focus {
    outline: none;
    border-color: #6b2181;
  }

  .form-actions {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
  }

  .btn-calculate {
    background: linear-gradient(135deg, #6b2181, #8b2a9b);
    color: white;
    border: none;
    padding: 1rem 3rem;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .btn-calculate:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(107, 33, 129, 0.4);
  }

  @media (max-width: 768px) {
    .form-grid {
      grid-template-columns: 1fr;
    }

    .radio-group {
      grid-template-columns: 1fr;
    }

    .consumos-mensuales {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>

<script>
  // Datos de departamentos y ciudades (se cargarán desde el servidor)
  const DEPARTAMENTOS_Y_CIUDADES = {
    'Antioquia': ['Medellín', 'Bello', 'Itagüí', 'Envigado', 'Sabaneta', 'La Ceja', 'Rionegro', 'Marinilla', 'El Retiro', 'Guarne', 'Copacabana', 'Girardota', 'Barbosa', 'Cisneros', 'Yondó', 'Puerto Berrío', 'Turbo', 'Apartadó', 'Carepa', 'Chigorodó'],
    'Cundinamarca': ['Bogotá', 'Soacha', 'Chía', 'Zipaquirá', 'Facatativá', 'Girardot', 'Fusagasugá', 'Sibaté', 'Mosquera', 'Madrid', 'Funza', 'Cajicá', 'Tabio', 'Tenjo'],
    'Valle del Cauca': ['Cali', 'Palmira', 'Buenaventura', 'Tuluá', 'Cartago', 'Buga', 'Yumbo', 'Ginebra', 'Guacarí', 'El Cerrito', 'Restrepo', 'La Cumbre'],
    'Atlántico': ['Barranquilla', 'Soledad', 'Malambo', 'Sabanagrande', 'Puerto Colombia', 'Galapa', 'Tubará', 'Usiacurí'],
    'Bolívar': ['Cartagena', 'Magangué', 'Turbaco', 'Arjona', 'Mahates', 'San Pablo', 'Santa Rosa', 'María la Baja'],
    'Santander': ['Bucaramanga', 'Floridablanca', 'Girón', 'Piedecuesta', 'Barrancabermeja', 'San Gil', 'Socorro', 'Barbosa'],
    'Risaralda': ['Pereira', 'Dosquebradas', 'Santa Rosa de Cabal', 'La Virginia', 'Cartago', 'Marsella'],
    'Caldas': ['Manizales', 'La Dorada', 'Chinchiná', 'Palestina', 'Villamaría', 'Anserma'],
    'Quindío': ['Armenia', 'Calarcá', 'La Tebaida', 'Montenegro', 'Quimbaya', 'Circasia'],
    'Tolima': ['Ibagué', 'Espinal', 'Girardot', 'Melgar', 'Flandes', 'Guamo'],
    'Magdalena': ['Santa Marta', 'Ciénaga', 'Fundación', 'Aracataca', 'El Banco', 'Plato'],
    'Cesar': ['Valledupar', 'Aguachica', 'Codazzi', 'La Paz', 'San Diego', 'Curumaní'],
    'Córdoba': ['Montería', 'Cereté', 'Sahagún', 'Lorica', 'Montelíbano', 'Planeta Rica'],
    'Sucre': ['Sincelejo', 'Corozal', 'Sampués', 'San Onofre', 'Coveñas', 'Tolú'],
    'Norte de Santander': ['Cúcuta', 'Villa del Rosario', 'Los Patios', 'El Zulia', 'San Cayetano'],
    'Huila': ['Neiva', 'Pitalito', 'Garzón', 'La Plata', 'Campoalegre'],
    'Cauca': ['Popayán', 'Santander de Quilichao', 'Puerto Tejada', 'Patía', 'Miranda'],
    'Nariño': ['Pasto', 'Tumaco', 'Ipiales', 'Túquerres', 'La Unión'],
    'Meta': ['Villavicencio', 'Acacías', 'Granada', 'San Martín', 'Restrepo'],
    'Casanare': ['Yopal', 'Aguazul', 'Tauramena', 'Villanueva'],
    'Arauca': ['Arauca', 'Saravena', 'Fortul'],
    'Putumayo': ['Mocoa', 'Puerto Asís', 'Orito'],
    'Amazonas': ['Leticia', 'Puerto Nariño'],
    'Guainía': ['Inírida'],
    'Guaviare': ['San José del Guaviare'],
    'Vaupés': ['Mitú'],
    'Vichada': ['Puerto Carreño'],
    'La Guajira': ['Riohacha', 'Maicao', 'Uribia', 'Manaure', 'San Juan del Cesar'],
    'Boyacá': ['Tunja', 'Duitama', 'Sogamoso', 'Chiquinquirá', 'Villa de Leyva'],
    'Chocó': ['Quibdó', 'Istmina', 'Condoto'],
  };

    // Mostrar/ocultar secciones según tipo de sistema y modelo de negocio
    document.addEventListener('DOMContentLoaded', function() {
      // Mostrar/ocultar información según modelo de negocio
      const modeloNegocioInputs = document.querySelectorAll('input[name="modeloNegocio"]');
      const infoEPC = document.getElementById('infoEPC');
      const infoPPA = document.getElementById('infoPPA');
      const datosPPA = document.getElementById('datosPPA');
      
      modeloNegocioInputs.forEach(input => {
        input.addEventListener('change', function() {
          if (this.value === 'epc') {
            if (infoEPC) infoEPC.style.display = 'block';
            if (infoPPA) infoPPA.style.display = 'none';
            if (datosPPA) datosPPA.style.display = 'none';
          } else if (this.value === 'ppa') {
            if (infoEPC) infoEPC.style.display = 'none';
            if (infoPPA) infoPPA.style.display = 'block';
            // Mostrar datos PPA solo si es On-Grid
            const tipoSistema = document.querySelector('input[name="tipoSistema"]:checked')?.value;
            if (datosPPA && (tipoSistema === 'on-grid' || tipoSistema === 'hibrido')) {
              datosPPA.style.display = 'block';
            }
          }
        });
      });
      
      // Mostrar/ocultar entidad financiera según financiación
      const financiacion = document.getElementById('financiacion');
      const entidadFinancieraGroup = document.getElementById('entidadFinancieraGroup');
      financiacion?.addEventListener('change', function() {
        if (entidadFinancieraGroup) {
          entidadFinancieraGroup.style.display = this.value === 'si' ? 'block' : 'none';
        }
      });
      
      // Mostrar/ocultar metraje de andamio según requiere andamios
      const requiereAndamios = document.getElementById('requiereAndamios');
      const metrajeAndamioGroup = document.getElementById('metrajeAndamioGroup');
      requiereAndamios?.addEventListener('change', function() {
        if (metrajeAndamioGroup) {
          metrajeAndamioGroup.style.display = this.value === 'si' ? 'block' : 'none';
        }
      });
      
      // Ajustar profundidad de descarga y eficiencia según tipo de batería (Off-Grid)
      const tipoBateriaOffGrid = document.getElementById('tipoBateriaOffGrid');
      const profundidadDescarga = document.getElementById('profundidadDescarga');
      const eficienciaBateria = document.getElementById('eficienciaBateria');
      
      tipoBateriaOffGrid?.addEventListener('change', function() {
        if (profundidadDescarga && eficienciaBateria) {
          if (this.value === 'litio') {
            profundidadDescarga.value = '90';
            eficienciaBateria.value = '0.95';
          } else {
            profundidadDescarga.value = '50';
            eficienciaBateria.value = '0.9';
          }
        }
      });
      
      // Calcular costo total por kWh según contribución
      // Sincronizar Costo Base y Tarifa (son el mismo valor)
      const costoKwhBase = document.getElementById('costoKwhBase');
      const tieneContribucion = document.getElementById('tieneContribucion');
      const tarifaElectrica = document.getElementById('tarifaElectrica');
      
      function actualizarTarifaElectrica() {
        if (costoKwhBase && tieneContribucion && tarifaElectrica) {
          const base = parseFloat(costoKwhBase.value) || 0;
          const contribucion = tieneContribucion.value === 'si' ? base * 0.2 : 0;
          const total = base + contribucion;
          if (total > 0) {
            tarifaElectrica.value = total.toFixed(2);
          }
        }
      }
      
      function sincronizarCostoBase() {
        if (tarifaElectrica && costoKwhBase) {
          const tarifa = parseFloat(tarifaElectrica.value) || 0;
          if (tarifa > 0) {
            costoKwhBase.value = tarifa.toFixed(2);
          }
        }
      }
      
      costoKwhBase?.addEventListener('input', actualizarTarifaElectrica);
      tarifaElectrica?.addEventListener('input', sincronizarCostoBase);
      tieneContribucion?.addEventListener('change', actualizarTarifaElectrica);
      
      // Cargar departamentos
      const selectDepartamento = document.getElementById('clienteDepartamento');
      const selectCiudad = document.getElementById('clienteCiudad');
      
      // Sincronizar Estación Meteorológica con Ciudad
      const estacionMeteorologica = document.getElementById('estacionMeteorologica');
      selectCiudad?.addEventListener('change', function() {
        if (estacionMeteorologica && this.value) {
          estacionMeteorologica.value = this.value;
        }
      });
      
      if (selectDepartamento) {
      const departamentos = Object.keys(DEPARTAMENTOS_Y_CIUDADES).sort();
      departamentos.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept;
        option.textContent = dept;
        selectDepartamento.appendChild(option);
      });
      
      // Cuando se selecciona un departamento, cargar sus ciudades
      selectDepartamento.addEventListener('change', function() {
        const departamento = this.value;
        selectCiudad.innerHTML = '<option value="">Seleccione una ciudad...</option>';
        
        if (departamento && DEPARTAMENTOS_Y_CIUDADES[departamento]) {
          selectCiudad.disabled = false;
          const ciudades = DEPARTAMENTOS_Y_CIUDADES[departamento].sort();
          ciudades.forEach(ciudad => {
            const option = document.createElement('option');
            option.value = ciudad;
            option.textContent = ciudad;
            selectCiudad.appendChild(option);
          });
        } else {
          selectCiudad.disabled = true;
        }
      });
      }
    
      const tipoSistemaInputs = document.querySelectorAll('input[name="tipoSistema"]');
      const datosOnGrid = document.getElementById('datosOnGrid');
      const datosOffGrid = document.getElementById('datosOffGrid');
      
      // Gestión de equipos Off-Grid
      let contadorEquipos = 0;
      const listaEquipos = document.getElementById('listaEquipos');
      const btnAgregarEquipo = document.getElementById('btnAgregarEquipo');
      const consumoDiarioCalculado = document.getElementById('consumoDiarioCalculado');
      
      function crearEquipoOffGrid(index) {
        const equipoDiv = document.createElement('div');
        equipoDiv.className = 'equipo-item';
        equipoDiv.dataset.index = index;
        
        equipoDiv.innerHTML = `
        <div class="equipo-header">
          <h5>Equipo ${index + 1}</h5>
          <button type="button" class="btn-remove-equipo" onclick="eliminarEquipo(${index})">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="form-grid-equipo">
          <div class="form-group">
            <label for="equipoNombre_${index}">Nombre del Equipo *</label>
            <input 
              type="text" 
              id="equipoNombre_${index}" 
              class="form-input equipo-nombre" 
              placeholder="Ej: Refrigerador, TV, Bombillos LED"
              required
            >
          </div>
          <div class="form-group">
            <label for="equipoPotencia_${index}">Potencia (W) *</label>
            <input 
              type="number" 
              id="equipoPotencia_${index}" 
              class="form-input equipo-potencia" 
              min="0" 
              step="0.1"
              placeholder="Ej: 150"
              required
            >
          </div>
          <div class="form-group">
            <label for="equipoCantidad_${index}">Cantidad *</label>
            <input 
              type="number" 
              id="equipoCantidad_${index}" 
              class="form-input equipo-cantidad" 
              min="1" 
              value="1"
              step="1"
              required
            >
          </div>
          <div class="form-group">
            <label for="equipoHorasUso_${index}">Horas de Uso Diario *</label>
            <input 
              type="number" 
              id="equipoHorasUso_${index}" 
              class="form-input equipo-horas" 
              min="0" 
              max="24"
              step="0.5"
              placeholder="Ej: 8"
              required
            >
          </div>
          <div class="form-group">
            <label for="equipoDiasSemana_${index}">Días de Uso por Semana *</label>
            <select id="equipoDiasSemana_${index}" class="form-input equipo-dias">
              <option value="7" selected>Todos los días (7 días)</option>
              <option value="6">6 días</option>
              <option value="5">5 días</option>
              <option value="4">4 días</option>
              <option value="3">3 días</option>
              <option value="2">2 días</option>
              <option value="1">1 día</option>
            </select>
          </div>
          <div class="form-group">
            <label for="equipoFactorPotencia_${index}">Factor de Potencia</label>
            <input 
              type="number" 
              id="equipoFactorPotencia_${index}" 
              class="form-input equipo-factor" 
              min="0" 
              max="1"
              step="0.01"
              value="1"
              placeholder="1.0"
            >
            <small class="form-help">Para equipos con motor o inductivos (0.7-0.9)</small>
          </div>
        </div>
        <div class="equipo-consumo">
          <span>Consumo de este equipo: </span>
          <strong id="consumoEquipo_${index}" class="consumo-equipo-value">0.00 kWh/día</strong>
        </div>
      `;
      
      return equipoDiv;
    }
    
    function calcularConsumoEquipo(index) {
      const potencia = parseFloat(document.getElementById(`equipoPotencia_${index}`)?.value || 0);
      const cantidad = parseFloat(document.getElementById(`equipoCantidad_${index}`)?.value || 1);
      const horasUso = parseFloat(document.getElementById(`equipoHorasUso_${index}`)?.value || 0);
      const diasSemana = parseFloat(document.getElementById(`equipoDiasSemana_${index}`)?.value || 7);
        const factorPotencia = parseFloat(document.getElementById(`equipoFactorPotencia_${index}`)?.value || 1);
        
        // Consumo diario = (Potencia * Cantidad * Horas * Factor) * (Días semana / 7)
        const consumoDiario = (potencia * cantidad * horasUso * factorPotencia / 1000) * (diasSemana / 7);
        
        const consumoElement = document.getElementById(`consumoEquipo_${index}`);
        if (consumoElement) {
          consumoElement.textContent = `${consumoDiario.toFixed(2)} kWh/día`;
        }
        
        return consumoDiario;
      }
      
      function calcularConsumoTotal() {
        const equipos = document.querySelectorAll('.equipo-item');
        let consumoTotal = 0;
        
        equipos.forEach(equipo => {
          const index = parseInt(equipo.dataset.index);
          consumoTotal += calcularConsumoEquipo(index);
        });
        
        if (consumoDiarioCalculado) {
          consumoDiarioCalculado.textContent = `${consumoTotal.toFixed(2)} kWh/día`;
        }
        
        return consumoTotal;
      }
      
      function agregarEquipo() {
        const nuevoEquipo = crearEquipoOffGrid(contadorEquipos);
        listaEquipos.appendChild(nuevoEquipo);
        
        // Agregar event listeners a los campos del nuevo equipo
        const inputs = nuevoEquipo.querySelectorAll('input, select');
        inputs.forEach(input => {
          input.addEventListener('input', calcularConsumoTotal);
          input.addEventListener('change', calcularConsumoTotal);
        });
        
        contadorEquipos++;
        
        // Si es el primer equipo, calcular
        if (contadorEquipos === 1) {
          calcularConsumoTotal();
        }
      }
      
      // Función global para eliminar equipos
      window.eliminarEquipo = function(index) {
        const equipo = document.querySelector(`.equipo-item[data-index="${index}"]`);
        if (equipo) {
          equipo.remove();
          calcularConsumoTotal();
        }
      };
      
      btnAgregarEquipo?.addEventListener('click', agregarEquipo);
      
      // Agregar primer equipo por defecto cuando se muestra la sección Off-Grid
      tipoSistemaInputs.forEach(input => {
        input.addEventListener('change', function() {
          if (this.value === 'off-grid' && contadorEquipos === 0) {
            // Limpiar lista si había equipos anteriores
            if (listaEquipos) {
              listaEquipos.innerHTML = '';
              contadorEquipos = 0;
            }
            // Agregar primer equipo
            setTimeout(() => {
              agregarEquipo();
            }, 100);
          }
        });
      });

      // Autoajustar consumos mensuales basado en el promedio
      const consumoPromedio = document.getElementById('consumoPromedio');
      const consumosMensuales = document.querySelectorAll('.consumo-mes');

      function generarConsumosMensuales(promedio) {
        if (isNaN(promedio) || promedio <= 0) return;
      
        // Meses con índice (0-11)
        const meses = Array.from(consumosMensuales);
        const variacionBase = 0.02; // 2%
        const variacionEspecial = 0.10; // 10% para julio y diciembre
        
        meses.forEach((input, index) => {
          let consumo;
          
          // Julio (índice 6) y Diciembre (índice 11) aumentan 10%
          if (index === 6 || index === 11) {
            consumo = promedio * (1 + variacionEspecial);
          } else {
            // Otros meses: variación aleatoria del 2% (puede ser + o -)
            // Usar un patrón determinístico basado en el índice para consistencia
            const variacion = (index % 2 === 0 ? 1 : -1) * variacionBase;
            consumo = promedio * (1 + variacion);
          }
          
          input.value = consumo.toFixed(1);
        });
      }

      consumoPromedio?.addEventListener('input', function() {
        const valor = parseFloat(this.value);
        if (!isNaN(valor) && valor > 0) {
          generarConsumosMensuales(valor);
        } else if (valor === 0 || this.value === '') {
          // Limpiar todos los campos si se borra el promedio
          consumosMensuales.forEach(input => {
            input.value = '';
          });
        }
      });
      
      // También generar cuando se carga la página si ya hay un valor
      if (consumoPromedio?.value) {
        const valor = parseFloat(consumoPromedio.value);
        if (!isNaN(valor) && valor > 0) {
          generarConsumosMensuales(valor);
        }
      }
    });
</script>

