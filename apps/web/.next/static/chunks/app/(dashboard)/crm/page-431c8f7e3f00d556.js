(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[419],{6853:function(e,s,a){Promise.resolve().then(a.bind(a,611))},611:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return N}});var t=a(7437),r=a(2265),i=a(9827),n=a(1713),l=a(1770),c=a(8320),d=a(2869),o=a(6070),x=a(9116),m=a(9397),h=a(9763);let p=(0,h.Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),u=(0,h.Z)("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);var y=a(7648);let j=["LEAD","CONTACTADO","DIAGNOSTICO","PROPUESTA_ENVIADA","NEGOCIACION","GANADO","PERDIDO"],v={LEAD:"Lead",CONTACTADO:"Contactado",DIAGNOSTICO:"Diagn\xf3stico",PROPUESTA_ENVIADA:"Propuesta Enviada",NEGOCIACION:"Negociaci\xf3n",GANADO:"Ganado",PERDIDO:"Perdido"};function N(){let[e,s]=(0,r.useState)("pipeline"),a=(0,i.NL)(),{data:h,isLoading:N}=(0,n.a)({queryKey:["opportunities"],queryFn:async()=>(await x.Z.get("/opportunities")).data}),{data:g,isLoading:f}=(0,n.a)({queryKey:["companies"],queryFn:async()=>(await x.Z.get("/companies")).data}),{data:b,isLoading:w}=(0,n.a)({queryKey:["contacts"],queryFn:async()=>(await x.Z.get("/contacts")).data}),{data:O}=(0,n.a)({queryKey:["pipeline-metrics"],queryFn:async()=>(await x.Z.get("/opportunities/pipeline/metrics")).data});(0,l.D)({mutationFn:async e=>{let{id:s,stage:a}=e;return(await x.Z.patch("/opportunities/".concat(s),{stage:a})).data},onSuccess:()=>{a.invalidateQueries({queryKey:["opportunities"]})}});let k=j.reduce((e,s)=>(e[s]=(null==h?void 0:h.filter(e=>e.stage===s))||[],e),{});return N||f||w?(0,t.jsx)(c.c,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary-700 border-r-transparent"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Cargando..."})]})})}):(0,t.jsx)(c.c,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"CRM"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Gesti\xf3n de clientes y oportunidades"})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(y.default,{href:"/crm/opportunities/new",children:(0,t.jsxs)(d.z,{children:[(0,t.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Nueva Oportunidad"]})}),(0,t.jsx)(y.default,{href:"/crm/companies/new",children:(0,t.jsxs)(d.z,{variant:"outline",children:[(0,t.jsx)(p,{className:"mr-2 h-4 w-4"}),"Nueva Empresa"]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-3",children:[(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(o.ll,{className:"text-sm font-medium",children:"Valor Total Pipeline"}),(0,t.jsx)(u,{className:"h-4 w-4 text-gray-500"})]}),(0,t.jsx)(o.aY,{children:(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["$",((null==O?void 0:O.totalValue)||0).toLocaleString()]})})]}),(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(o.ll,{className:"text-sm font-medium",children:"Valor Ponderado"}),(0,t.jsx)(u,{className:"h-4 w-4 text-gray-500"})]}),(0,t.jsx)(o.aY,{children:(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["$",((null==O?void 0:O.weightedValue)||0).toLocaleString()]})})]}),(0,t.jsxs)(o.Zb,{children:[(0,t.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(o.ll,{className:"text-sm font-medium",children:"Total Oportunidades"}),(0,t.jsx)(u,{className:"h-4 w-4 text-gray-500"})]}),(0,t.jsx)(o.aY,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==O?void 0:O.totalCount)||0})})]})]}),(0,t.jsx)("div",{className:"border-b border-gray-200",children:(0,t.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,t.jsx)("button",{onClick:()=>s("pipeline"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("pipeline"===e?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Pipeline"}),(0,t.jsxs)("button",{onClick:()=>s("companies"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("companies"===e?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Empresas (",(null==g?void 0:g.length)||0,")"]}),(0,t.jsxs)("button",{onClick:()=>s("contacts"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("contacts"===e?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Contactos (",(null==b?void 0:b.length)||0,")"]})]})}),"pipeline"===e&&(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsx)("div",{className:"flex space-x-4 min-w-max pb-4",children:j.map(e=>{var s,a;return(0,t.jsx)("div",{className:"flex-shrink-0 w-80",children:(0,t.jsxs)(o.Zb,{children:[(0,t.jsx)(o.Ol,{children:(0,t.jsxs)(o.ll,{className:"text-sm font-medium",children:[v[e]," (",(null===(s=k[e])||void 0===s?void 0:s.length)||0,")"]})}),(0,t.jsxs)(o.aY,{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[null===(a=k[e])||void 0===a?void 0:a.map(e=>{var s;return(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition cursor-pointer",onClick:()=>window.location.href="/crm/opportunities/".concat(e.id),children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:null===(s=e.company)||void 0===s?void 0:s.name}),(0,t.jsxs)("div",{className:"text-sm font-semibold text-primary-600 mt-2",children:["$",e.estimatedValue.toLocaleString()]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Probabilidad: ",e.probability,"%"]})]},e.id)}),(!k[e]||0===k[e].length)&&(0,t.jsx)("div",{className:"text-center text-sm text-gray-400 py-8",children:"Sin oportunidades"})]})]})},e)})})}),"companies"===e&&(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[null==g?void 0:g.map(e=>{var s;return(0,t.jsxs)(o.Zb,{className:"cursor-pointer hover:shadow-lg transition",onClick:()=>window.location.href="/crm/companies/".concat(e.id),children:[(0,t.jsx)(o.Ol,{children:(0,t.jsx)(o.ll,{className:"text-lg",children:e.name})}),(0,t.jsx)(o.aY,{children:(0,t.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[e.nit&&(0,t.jsxs)("div",{children:["NIT: ",e.nit]}),e.sector&&(0,t.jsxs)("div",{children:["Sector: ",e.sector]}),e.city&&(0,t.jsxs)("div",{children:["Ciudad: ",e.city]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(null===(s=e.contacts)||void 0===s?void 0:s.length)||0," contactos"]})]})})]},e.id)}),(!g||0===g.length)&&(0,t.jsx)(o.Zb,{className:"col-span-full",children:(0,t.jsx)(o.aY,{className:"py-8 text-center text-gray-500",children:"No hay empresas registradas. Crea tu primera empresa para comenzar."})})]}),"contacts"===e&&(0,t.jsxs)("div",{className:"space-y-4",children:[null==b?void 0:b.map(e=>{var s;return(0,t.jsx)(o.Zb,{className:"cursor-pointer hover:shadow-lg transition",onClick:()=>window.location.href="/crm/contacts/".concat(e.id),children:(0,t.jsx)(o.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.firstName," ",e.lastName]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:null===(s=e.company)||void 0===s?void 0:s.name}),e.position&&(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.position})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[e.email&&(0,t.jsx)("div",{children:e.email}),e.phone&&(0,t.jsx)("div",{children:e.phone})]})]})})},e.id)}),(!b||0===b.length)&&(0,t.jsx)(o.Zb,{children:(0,t.jsx)(o.aY,{className:"py-8 text-center text-gray-500",children:"No hay contactos registrados."})})]})]})})}},9397:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}},function(e){e.O(0,[301,21,429,713,82,971,117,744],function(){return e(e.s=6853)}),_N_E=e.O()}]);